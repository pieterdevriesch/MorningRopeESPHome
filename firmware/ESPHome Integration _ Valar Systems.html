<!DOCTYPE html>
<!-- saved from url=(0145)https://webcache.googleusercontent.com/search?q=cache:_SYTJIgbPcAJ:https://help.valarsystems.com/docs/VAL-1000/ESPHome/+&cd=6&hl=en&ct=clnk&gl=nl -->
<html lang="en" dir="ltr" data-theme="light"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><!--<base href="https://help.valarsystems.com/docs/VAL-1000/ESPHome/">--><base href="."><style>body{margin-left:0;margin-right:0;margin-top:0}#bN015htcoyT__google-cache-hdr{background:#f8f9fa;font:13px arial,sans-serif;text-align:left;color:#202124;border:0;margin:0;border-bottom:1px solid #dadce0;line-height:16px;padding:16px 28px 24px 28px}#bN015htcoyT__google-cache-hdr *{display:inline;font:inherit;text-align:inherit;color:inherit;line-height:inherit;background:none;border:0;margin:0;padding:0;letter-spacing:0}#bN015htcoyT__google-cache-hdr a{text-decoration:none;color:#1a0dab}#bN015htcoyT__google-cache-hdr a:hover{text-decoration:underline}#bN015htcoyT__google-cache-hdr a:visited{color:#681da8}#bN015htcoyT__google-cache-hdr div{display:block;margin-top:4px}#bN015htcoyT__google-cache-hdr b{font-weight:bold;display:inline-block;direction:ltr}</style></head><body><div id="bN015htcoyT__google-cache-hdr"><div><span>This is Google's cache of <a href="https://help.valarsystems.com/docs/VAL-1000/ESPHome/">https://help.valarsystems.com/docs/VAL-1000/ESPHome/</a>.</span>&nbsp;<span>It is a snapshot of the page as it appeared on 24 Jun 2022 14:53:40 GMT.</span>&nbsp;<span>The <a href="https://help.valarsystems.com/docs/VAL-1000/ESPHome/">current page</a> could have changed in the meantime.</span>&nbsp;<a href="http://support.google.com/websearch/bin/answer.py?hl=en&amp;p=cached&amp;answer=1687222"><span>Learn more</span>.</a></div><div><span style="display:inline-block;margin-top:8px;margin-right:104px;white-space:nowrap"><span style="margin-right:28px"><span style="font-weight:bold">Full version</span></span><span style="margin-right:28px"><a href="http://webcache.googleusercontent.com/search?q=cache:_SYTJIgbPcAJ:https://help.valarsystems.com/docs/VAL-1000/ESPHome/&amp;hl=en&amp;gl=nl&amp;strip=1&amp;vwsrc=0"><span>Text-only version</span></a></span><span style="margin-right:28px"><a href="http://webcache.googleusercontent.com/search?q=cache:_SYTJIgbPcAJ:https://help.valarsystems.com/docs/VAL-1000/ESPHome/&amp;hl=en&amp;gl=nl&amp;strip=0&amp;vwsrc=1"><span>View source</span></a></span></span></div><span style="display:inline-block;margin-top:8px;color:#70757a"><span>Tip: To quickly find your search term on this page, press <b>Ctrl+F</b> or <b>âŒ˜-F</b> (Mac) and use the find bar.</span></span></div><div style="position:relative;">



<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.0">
<link rel="alternate" type="application/rss+xml" href="https://help.valarsystems.com/blog/rss.xml" title="Valar Systems Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="https://help.valarsystems.com/blog/atom.xml" title="Valar Systems Blog Atom Feed"><title data-react-helmet="true">ESPHome Integration | Valar Systems</title><meta data-react-helmet="true" property="og:url" content="https://daniel-frenkel.github.io/docs/VAL-1000/ESPHome"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="ESPHome Integration | Valar Systems"><meta data-react-helmet="true" name="description" content="ESPHome V1.18 is required."><meta data-react-helmet="true" property="og:description" content="ESPHome V1.18 is required."><link data-react-helmet="true" rel="shortcut icon" href="https://help.valarsystems.com/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://daniel-frenkel.github.io/docs/VAL-1000/ESPHome"><link data-react-helmet="true" rel="alternate" href="https://daniel-frenkel.github.io/docs/VAL-1000/ESPHome" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://daniel-frenkel.github.io/docs/VAL-1000/ESPHome" hreflang="x-default"><link rel="stylesheet" href="./ESPHome Integration _ Valar Systems_files/styles.54412775.css">
<link rel="preload" href="./ESPHome Integration _ Valar Systems_files/runtime_main.39f83498.js.download" as="script">
<link rel="preload" href="./ESPHome Integration _ Valar Systems_files/main.95cb241e.js.download" as="script">


<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="https://help.valarsystems.com/docs/VAL-1000/ESPHome/#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="https://help.valarsystems.com/"><img src="./ESPHome Integration _ Valar Systems_files/logo.svg" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="./ESPHome Integration _ Valar Systems_files/logo.svg" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Documentation</strong></a><a class="navbar__item navbar__link navbar__link--active" href="https://help.valarsystems.com/docs/intro">Tutorial</a><a class="navbar__item navbar__link" href="https://help.valarsystems.com/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="https://help.valarsystems.com/"><img src="./ESPHome Integration _ Valar Systems_files/logo.svg" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="./ESPHome Integration _ Valar Systems_files/logo.svg" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Documentation</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link navbar__link--active" href="https://help.valarsystems.com/docs/intro">Tutorial</a></li><li class="menu__list-item"><a class="menu__link" href="https://help.valarsystems.com/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="https://help.valarsystems.com/docs/intro">Valar Documentation</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="https://help.valarsystems.com/docs/VAL-1000/ESPHome/#!">3D Printing Guides</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="https://help.valarsystems.com/docs/3D%20Printing%20Guides/3D_print_guide">3D Printing Build Guides</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="https://help.valarsystems.com/docs/VAL-1000/ESPHome/#!">MorningRope</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="https://help.valarsystems.com/docs/MorningRope/valar_s1">Cloud Setup</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="https://help.valarsystems.com/docs/MorningRope/setup_guide">Hardware Setup</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="https://help.valarsystems.com/docs/VAL-1000/ESPHome/#!">VAL-1000</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="https://help.valarsystems.com/docs/VAL-1000/VAL-1000">VAL-1000</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="https://help.valarsystems.com/docs/VAL-1000/StallGuard">StallGuard</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="https://help.valarsystems.com/docs/VAL-1000/ESPHome">ESPHome Integration</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="https://help.valarsystems.com/docs/VAL-1000/ESPHome/#!">Window Opener</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="https://help.valarsystems.com/docs/Window%20Opener/valar_w1">VALAR W1: Window Opener Setup Instructions</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">ESPHome Integration</h1></header><div class="markdown"><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>ESPHome V1.18 is required.
This guide also assumes you have prior knowledge using ESPHome with Home Assistant.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="1-add-new-device"></a>1. Add New Device<a class="hash-link" href="https://help.valarsystems.com/docs/VAL-1000/ESPHome/#1-add-new-device" title="Direct link to heading">#</a></h2><p>Begin by adding a new device in ESPHome. Copy the code below into the YAML file, completely replacing what is there. </p><p>Change the "device_name" to what you'd like.</p><p>Do not change any of the other values at the moment, we will do that later.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">substitutions:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  device_name: val-1000</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  pulley_diameter_mm: "12.2" # 1 turn about 47 mm</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  gear_ratio: "1" # not used yet for simplicity</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  distance_mm: "600" # about 10 turns</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  acceleration: 600 steps/s^2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  velocity: 600 steps/s # 1 turn per second</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  open_current: 800ma</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  open_stall_threshold: "20"</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  close_current: 800ma</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  close_stall_threshold: "20"</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  tcool_threshold: "910"</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  microsteps: "2"</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  change_direction: "True"</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">external_components:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  source: github://glmnet/esphome@stepper-tmc2209</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  components: [tmc2209]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">esphome:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  name: ${device_name}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  platform: ESP32</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  board: nodemcu-32s</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  platformio_options:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    upload_speed: 921600</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  on_boot:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - tmc2209.setup:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        microsteps: 2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        tcool_threshold: ${tcool_threshold}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        current: 600mA</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        stall_threshold: 20</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">wifi:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ssid: SSID</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  password: PASSWWORD</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Enable logging</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">logger:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  level: INFO</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># verbose logger over uart causes motor artifacts as pulses are generated in main loop</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># logger:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#   level: VERY_VERBOSE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#   logs:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#     api: DEBUG</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#     api.service: DEBUG</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#     scheduler: DEBUG</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ota:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">uart:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  id: uart_stepper</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  tx_pin: GPIO17</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  rx_pin: GPIO16</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  baud_rate: 9600</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">status_led:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  pin: GPIO26</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">api:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  services:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - service: control_stepper</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      variables:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        target: int</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        speed: int</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        microsteps: int</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        tcool_threshold: int</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        stall_threshold: int</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        rms_current_amps: float</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      then:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        - tmc2209.setup:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            id: my_stepper</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            microsteps: !lambda "return microsteps;"</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            tcool_threshold: !lambda "return tcool_threshold;"</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            stall_threshold: !lambda "return stall_threshold;"</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            current: !lambda "return rms_current_amps;"</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        - logger.log:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            format: moving to %d</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            args: [target]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        - stepper.set_speed:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            id: my_stepper</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            speed: !lambda "return speed;"</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        - stepper.set_target:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            id: my_stepper</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            target: !lambda "return target;"</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - service: set_stepper_zero</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      then:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        - stepper.report_position:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            id: my_stepper</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            position: 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        - stepper.set_target:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            id: my_stepper</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            target: 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">binary_sensor:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  - platform: gpio</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    name: Button1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pin:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      number: GPIO23</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      inverted: true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      mode: INPUT</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    on_press:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      then:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        - cover.open:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            id: template_cov</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  - platform: gpio</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    name: Button2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pin:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      number: GPIO34</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      inverted: true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      mode: INPUT</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    on_press:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      then:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        - cover.close:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            id: template_cov</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  - platform: gpio</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    name: Sensor1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pin:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      number: GPIO22</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      inverted: true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  - platform: gpio</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    name: SensorGPIO0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pin:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      number: GPIO0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      inverted: true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  - platform: gpio</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    name: Sensor2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pin:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      number: GPIO32</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      inverted: true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  - platform: gpio</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    id: stall_guard_sensor</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    name: StallGuard</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pin: GPIO2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    on_press:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      script.execute: stop_at_current_position</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">stepper:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  - platform: tmc2209</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    id: my_stepper</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    step_pin: GPIO13</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    dir_pin: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      number: GPIO14</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      inverted: ${change_direction}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    sleep_pin:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      number: GPIO27</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      inverted: true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    acceleration: ${acceleration}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    max_speed: ${velocity}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">script:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  - id: stop_at_current_position</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    then:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      stepper.set_target:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        id: my_stepper</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        target: !lambda "return id(my_stepper).current_position;"</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">globals:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  - id: open_position</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    type: float</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    initial_value: ${distance_mm} / (${pulley_diameter_mm} * PI) * 200 * ${microsteps}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cover:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  - platform: template</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    id: template_cov</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    name: "${device_name} cover"</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    open_action:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      - tmc2209.setup:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          current: ${open_current}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          stall_threshold: ${open_stall_threshold}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          microsteps: 2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      - stepper.set_target:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          id: my_stepper</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          target: !lambda "return id(open_position);"</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    close_action:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      - tmc2209.setup:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          current: ${close_current}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          stall_threshold: ${close_stall_threshold}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          microsteps: 2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      - stepper.set_target:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          id: my_stepper</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          # 0 Means closed</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          target: 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    position_action:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      - stepper.set_target:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          id: my_stepper</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          target: !lambda "return id(open_position) * pos;"</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    stop_action:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      - script.execute: stop_at_current_position</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">interval:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  interval: 5s</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  then:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    lambda: |-</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      static auto operation = COVER_OPERATION_IDLE;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      static auto position = id(my_stepper).current_position;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      if (operation != id(template_cov).current_operation ||</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          position != id(my_stepper).current_position)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        ESP_LOGD("main", "Stepper Position is: %d/%d", id(my_stepper).current_position, (int)id(open_position));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        if (id(my_stepper).current_position &gt; id(my_stepper).target_position)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          operation = COVER_OPERATION_CLOSING;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        else if (id(my_stepper).current_position &lt; id(my_stepper).target_position)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          operation = COVER_OPERATION_OPENING;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        else</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          operation = COVER_OPERATION_IDLE;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        id(template_cov).current_operation = operation;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        position =  id(my_stepper).current_position;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        id(template_cov).position = position / id(open_position);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        id(template_cov).publish_state();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Be sure 12V power is plugged in to the board</p></div></div><p>Compile and upload via USB.</p><p>Test the board by pressing one of the buttons and motion should begin.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="2-setting-parameters"></a>2. Setting Parameters<a class="hash-link" href="https://help.valarsystems.com/docs/VAL-1000/ESPHome/#2-setting-parameters" title="Direct link to heading">#</a></h2><p>You have the ability to set the following parameters of your device</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">a. pulley_diameter_mm:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">b. gear_ratio:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">c. distance_mm:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">d. acceleration:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">e. velocity:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">f. open_current:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">g. open_stall_threshold:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">h. close_current:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">i. close_stall_threshold:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">j. tcool_threshold:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">k. microsteps:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">l. inverted</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>To set the parmeters, you need to update the YAML file and compile and upload it each time you want to change a parameter. This can make it very difficult to dial some of these values in. </p><p>To fix this, we've added a service that will allow you to test different values without requiring complilation or upload. Once you dial in the correct value, you can update the YAML file accordingly. This will limit the amount of time you spend on compiling and uploading. </p><p>To use the service, navigate to <strong>Developer Tools</strong> --&gt; <strong>Services</strong> tab.</p><p>From the Service dropdown list, find ESPHome: &lt;YOUR-DEVICE&gt;_control_stepper and select it.</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>The service called ESPHome: &lt;YOUR-DEVICE&gt;_set_stepper_zero will set the the current position to 0, which is the home position. Call this to reset the home position.</p></div></div><p>You will see the following:</p><p><img alt="Services" src="./ESPHome Integration _ Valar Systems_files/services-97728bbc55af8115992a468c490cdc81.png"></p><p>Use the service to update values and test them out.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>These values will not save. You will need to update the YAML file with these values.</p></div></div><p>As noted above, changing the values will not save them. This tool is only used for dialing in the correct value. Once the values are determined, go back to the YAML file in ESPHome and update the values in the file. Save and upload the file.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="services-configuration"></a>Services Configuration<a class="hash-link" href="https://help.valarsystems.com/docs/VAL-1000/ESPHome/#services-configuration" title="Direct link to heading">#</a></h2><p>To find the correct values for your application, begin by changing the values in the sevices. </p><p>Begin by manually moving your device to the home position. </p><p>Change your Service to ESPHome: &lt;YOUR-DEVICE&gt;_set_stepper_zero</p><p>Press the CALL SERVICE to set your home position</p><p><img alt="Services" src="./ESPHome Integration _ Valar Systems_files/zero_service-b8c6f659569be84f46ba4f25d4d73f28.png"></p><p>Now switch the Service to ESPHome: &lt;YOUR-DEVICE&gt;_control_stepper </p><p>You will find the following values that can be changed:</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="target"></a>target<a class="hash-link" href="https://help.valarsystems.com/docs/VAL-1000/ESPHome/#target" title="Direct link to heading">#</a></h3><p>This value is in steps. Most stepper motors have 200 steps per revolution. Each step is multiplies by microsteps value below. If using 64 microsteps, that means each motor revolution will require 12800 steps.</p><p>If using the small pulley that comes with the string curtain opener, there are 10000 steps per inch when setting the microsteps to 64. </p><p>To change the motor direction, change this value to a negative.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="speed"></a>speed<a class="hash-link" href="https://help.valarsystems.com/docs/VAL-1000/ESPHome/#speed" title="Direct link to heading">#</a></h3><p>Begin at 5000 which is a slow but silent speed. </p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="microsteps"></a>microsteps<a class="hash-link" href="https://help.valarsystems.com/docs/VAL-1000/ESPHome/#microsteps" title="Direct link to heading">#</a></h3><p>Set to 64 unless you have a good reason to change it to something else.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="tcool_threshold"></a>tcool_threshold<a class="hash-link" href="https://help.valarsystems.com/docs/VAL-1000/ESPHome/#tcool_threshold" title="Direct link to heading">#</a></h3><p>See the <a href="https://help.valarsystems.com/docs/VAL-1000/StallGuard">StallGuard</a> page to learn more. </p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="stall_threshold"></a>stall_threshold<a class="hash-link" href="https://help.valarsystems.com/docs/VAL-1000/ESPHome/#stall_threshold" title="Direct link to heading">#</a></h3><p>See the <a href="https://help.valarsystems.com/docs/VAL-1000/StallGuard">StallGuard</a> page to learn more. </p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="rms_current_amps"></a>rms_current_amps<a class="hash-link" href="https://help.valarsystems.com/docs/VAL-1000/ESPHome/#rms_current_amps" title="Direct link to heading">#</a></h3><p>See the <a href="https://help.valarsystems.com/docs/VAL-1000/StallGuard">StallGuard</a> page to learn more. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="yaml-configuration"></a>YAML Configuration<a class="hash-link" href="https://help.valarsystems.com/docs/VAL-1000/ESPHome/#yaml-configuration" title="Direct link to heading">#</a></h2><p>Here are the values that you can change in the YAML file</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="a-pulley_diameter_mm"></a>a. pulley_diameter_mm:<a class="hash-link" href="https://help.valarsystems.com/docs/VAL-1000/ESPHome/#a-pulley_diameter_mm" title="Direct link to heading">#</a></h3><p>Most motors require a pulley to attach a belt to. Enter the the diameter (in millimeters) of this pulley. A formula will use this value and the distance value to calculate the number of steps to move.</p><p>If using a lead screw, set the diameter of the lead screw.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="b-gear_ratio"></a>b. gear_ratio:<a class="hash-link" href="https://help.valarsystems.com/docs/VAL-1000/ESPHome/#b-gear_ratio" title="Direct link to heading">#</a></h3><p>If no gear is used, set this to "1".</p><p>If using a gear, set the value of the ratio by using an integer. For example, is using a 7:1 gear (requires 7 input rotations to output 1 rotations) set this value to "7".</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="c-distance_mm"></a>c. distance_mm:<a class="hash-link" href="https://help.valarsystems.com/docs/VAL-1000/ESPHome/#c-distance_mm" title="Direct link to heading">#</a></h3><p>What is the total distance, in millimeters, that you need to move.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="d-acceleration"></a>d. acceleration:<a class="hash-link" href="https://help.valarsystems.com/docs/VAL-1000/ESPHome/#d-acceleration" title="Direct link to heading">#</a></h3><p>What is the acceleration value. If using StallGuard, read the StallGuard section before setting this value.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="e-velocity"></a>e. velocity:<a class="hash-link" href="https://help.valarsystems.com/docs/VAL-1000/ESPHome/#e-velocity" title="Direct link to heading">#</a></h3><p>What is the maximum velocity value.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="f-open_current"></a>f. open_current:<a class="hash-link" href="https://help.valarsystems.com/docs/VAL-1000/ESPHome/#f-open_current" title="Direct link to heading">#</a></h3><p>Set the open current in milliamps. The maximum for the VAL-1000 is 2000. </p><div class="admonition admonition-danger alert alert--danger"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>danger</h5></div><div class="admonition-content"><p>Be sure to properly match your power supply to the amount of current you are setting.</p><p>This value is the Root Mean Square (RMS) current, and is <strong>not</strong> the maximum current. Multiply this value by 1.41 to find the maximum current. </p><p>For example, if setting to 2000mA, the max current used by the TMC2209 will be 2000 x 1.41 = 2820mA</p><p>In addition, alwasy reserve 500mA for the ESP32 as it may require up to 500mA during WiFi transmission. </p><p>In this scenario, you will need at least a 3.4A power supply.</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="g-open_stall_threshold"></a>g. open_stall_threshold:<a class="hash-link" href="https://help.valarsystems.com/docs/VAL-1000/ESPHome/#g-open_stall_threshold" title="Direct link to heading">#</a></h3><p>See the <a href="https://help.valarsystems.com/docs/VAL-1000/StallGuard">StallGuard</a> page to learn more. </p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="h-close_current"></a>h. close_current:<a class="hash-link" href="https://help.valarsystems.com/docs/VAL-1000/ESPHome/#h-close_current" title="Direct link to heading">#</a></h3><p>Set the close current in miliamps. Note the warnings in the open current section.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="i-close_stall_threshold"></a>i. close_stall_threshold:<a class="hash-link" href="https://help.valarsystems.com/docs/VAL-1000/ESPHome/#i-close_stall_threshold" title="Direct link to heading">#</a></h3><p>See the <a href="https://help.valarsystems.com/docs/VAL-1000/StallGuard">StallGuard</a> page to learn more. </p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="j-tcool_threshold"></a>j. tcool_threshold:<a class="hash-link" href="https://help.valarsystems.com/docs/VAL-1000/ESPHome/#j-tcool_threshold" title="Direct link to heading">#</a></h3><p>See the <a href="https://help.valarsystems.com/docs/VAL-1000/StallGuard">StallGuard</a> page to learn more. </p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="k-microsteps"></a>k. microsteps:<a class="hash-link" href="https://help.valarsystems.com/docs/VAL-1000/ESPHome/#k-microsteps" title="Direct link to heading">#</a></h3><p>Set the number of microsteps. This is not as straightforward as it may seem so please read. </p><p>Set to 64 if you want it to work well. Keep reading to learn more. </p><p>The TMC2209 has a feature called Microplyer that automatically turns low step resolutions into 256 microstepssteps. For example, if you set the above value to 1, each step pulse will automatically get turned into 256 microsteps. The downside is that accuracy also goes down, as you cannot set your position to any of the microsteps that microplyer creates. </p><p>On the other hand, setting this value to 256 will limit the top speed of the motor because the ESP32 simply cannot generate pulses fast enough to move the motor very fast. </p><p>The value 64 is a good sweet spot that allows the TMC2209 to run at its top speed while also remaining as accurate as possible. </p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="l-invert-motor-direction"></a>l. invert motor direction<a class="hash-link" href="https://help.valarsystems.com/docs/VAL-1000/ESPHome/#l-invert-motor-direction" title="Direct link to heading">#</a></h3><p>If you need to change the direction the motor is turning, change the "inverted" value, under the dir_pin to True or False, depending which way it needs to spin.</p><p>stepper:</p><ul><li><p>platform: tmc2209
id: my_stepper</p><p>step_pin: GPIO13
dir_pin:
number: GPIO14
inverted: True</p></li></ul></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/master/website/docs/VAL-1000/ESPHome.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="https://help.valarsystems.com/docs/VAL-1000/StallGuard"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« StallGuard</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="https://help.valarsystems.com/docs/Window%20Opener/valar_w1"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">VALAR W1: Window Opener Setup Instructions Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="https://help.valarsystems.com/docs/VAL-1000/ESPHome/#1-add-new-device" class="table-of-contents__link">1. Add New Device</a></li><li><a href="https://help.valarsystems.com/docs/VAL-1000/ESPHome/#2-setting-parameters" class="table-of-contents__link">2. Setting Parameters</a></li><li><a href="https://help.valarsystems.com/docs/VAL-1000/ESPHome/#services-configuration" class="table-of-contents__link">Services Configuration</a><ul><li><a href="https://help.valarsystems.com/docs/VAL-1000/ESPHome/#target" class="table-of-contents__link">target</a></li><li><a href="https://help.valarsystems.com/docs/VAL-1000/ESPHome/#speed" class="table-of-contents__link">speed</a></li><li><a href="https://help.valarsystems.com/docs/VAL-1000/ESPHome/#microsteps" class="table-of-contents__link">microsteps</a></li><li><a href="https://help.valarsystems.com/docs/VAL-1000/ESPHome/#tcool_threshold" class="table-of-contents__link">tcool_threshold</a></li><li><a href="https://help.valarsystems.com/docs/VAL-1000/ESPHome/#stall_threshold" class="table-of-contents__link">stall_threshold</a></li><li><a href="https://help.valarsystems.com/docs/VAL-1000/ESPHome/#rms_current_amps" class="table-of-contents__link">rms_current_amps</a></li></ul></li><li><a href="https://help.valarsystems.com/docs/VAL-1000/ESPHome/#yaml-configuration" class="table-of-contents__link">YAML Configuration</a><ul><li><a href="https://help.valarsystems.com/docs/VAL-1000/ESPHome/#a-pulley_diameter_mm" class="table-of-contents__link">a. pulley_diameter_mm:</a></li><li><a href="https://help.valarsystems.com/docs/VAL-1000/ESPHome/#b-gear_ratio" class="table-of-contents__link">b. gear_ratio:</a></li><li><a href="https://help.valarsystems.com/docs/VAL-1000/ESPHome/#c-distance_mm" class="table-of-contents__link">c. distance_mm:</a></li><li><a href="https://help.valarsystems.com/docs/VAL-1000/ESPHome/#d-acceleration" class="table-of-contents__link">d. acceleration:</a></li><li><a href="https://help.valarsystems.com/docs/VAL-1000/ESPHome/#e-velocity" class="table-of-contents__link">e. velocity:</a></li><li><a href="https://help.valarsystems.com/docs/VAL-1000/ESPHome/#f-open_current" class="table-of-contents__link">f. open_current:</a></li><li><a href="https://help.valarsystems.com/docs/VAL-1000/ESPHome/#g-open_stall_threshold" class="table-of-contents__link">g. open_stall_threshold:</a></li><li><a href="https://help.valarsystems.com/docs/VAL-1000/ESPHome/#h-close_current" class="table-of-contents__link">h. close_current:</a></li><li><a href="https://help.valarsystems.com/docs/VAL-1000/ESPHome/#i-close_stall_threshold" class="table-of-contents__link">i. close_stall_threshold:</a></li><li><a href="https://help.valarsystems.com/docs/VAL-1000/ESPHome/#j-tcool_threshold" class="table-of-contents__link">j. tcool_threshold:</a></li><li><a href="https://help.valarsystems.com/docs/VAL-1000/ESPHome/#k-microsteps" class="table-of-contents__link">k. microsteps:</a></li><li><a href="https://help.valarsystems.com/docs/VAL-1000/ESPHome/#l-invert-motor-direction" class="table-of-contents__link">l. invert motor direction</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="https://help.valarsystems.com/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="https://help.valarsystems.com/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="./ESPHome Integration _ Valar Systems_files/runtime_main.39f83498.js.download"></script>
<script src="./ESPHome Integration _ Valar Systems_files/main.95cb241e.js.download"></script>

</div></body></html>